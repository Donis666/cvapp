<!-- <!DOCTYPE html>
<html>
  <head>
    <title>Camera Processing</title>
  </head>
  <body>
    <video id="video" width="640" height="480" autoplay></video>
    <canvas id="canvas" width="640" height="480"></canvas>
    <img id="processed-image" src="" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
      var video = document.getElementById('video');
      var canvas = document.getElementById('canvas');
      var context = canvas.getContext('2d');

      if (navigator.mediaDevices.getUserMedia) {
        navigator.mediaDevices.getUserMedia({ video: true })
          .then(function (stream) {
            video.srcObject = stream;
          })
          .catch(function (error) {
            console.log("Error: " + error);
          });
      }

      setInterval(function () {
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        var dataURL = canvas.toDataURL("image/jpeg");
        $.ajax({
          type: "POST",
          url: "/process",
          data: { image: dataURL },
          success: function (response) {
            $('#processed-image').attr('src', 'data:image/jpeg;base64,' + response.result);
          },
          error: function (xhr, status, error) {
            console.log("Error: " + error);
          }
        });
      }, 100);
    </script>
  </body>
</html> -->


<!DOCTYPE html>
<html>
  <head>
    <title>Camera Processing</title>
  </head>
  <body>
    <img id="processed-image" src="" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
      if (navigator.mediaDevices.getUserMedia) {
        navigator.mediaDevices.getUserMedia({ video: true })
          .then(function (stream) {
            var video = document.createElement('video');
            video.srcObject = stream;
            video.play();

            var canvas = document.createElement('canvas');
            var context = canvas.getContext('2d');

            setInterval(function () {
              canvas.width = video.videoWidth;
              canvas.height = video.videoHeight;
              context.drawImage(video, 0, 0, canvas.width, canvas.height);
              var dataURL = canvas.toDataURL("image/jpeg");
              $.ajax({
                type: "POST",
                url: "/process",
                data: { image: dataURL },
                success: function (response) {
                  $('#processed-image').attr('src', 'data:image/jpeg;base64,' + response.result);
                },
                error: function (xhr, status, error) {
                  console.log("Error: " + error);
                }
              });
            }, 50);
          })
          .catch(function (error) {
            console.log("Error: " + error);
          });
      }
    </script>
  </body>
</html>
